---
title: "R Notebook"
output:
  html_document: default
  html_notebook:
    fig_caption: yes
    tab_caption: yes
---

Perfom benchmarkinng tests on [`sprawl::comp_zonal`]

```{r, echo=FALSE, message=FALSE, warning=FALSE}

  library(sprawl)
  library(microbenchmark)
  library(profvis)
  library(raster)
  library(ggplot2)
  in_polys <- readshape(system.file("extdata","lc_polys.shp", package = "sprawl"), stringsAsFactors = T)
  in_rast  <- raster::stack(system.file("extdata", "sprawl_EVItest.tif", package = "sprawl"))
  mb = microbenchmark(
    raster_extract = {raster::extract(in_rast[[1:46]], as(in_polys, "Spatial"), FUN = mean, sp = T )}, 
    # b = {outsmall <- comp_zonal(in_rast, in_polys, verbose = FALSE, 
    #                        mode = "std", selbands = c(1,20), maxchunk = 5E4)},
    czonal_med = {comp_zonal(in_rast, in_polys, verbose = FALSE,
                           mode = "std", selbands = c(1,46),   maxchunk = 10E4, full_data = F, addgeom = T)},
    czonal_big = {comp_zonal(in_rast, in_polys, verbose = FALSE, 
                           mode = "std",selbands = c(1,46),    maxchunk = 100E4, full_data = F, addgeom = T)},
    times = 1)
  mbsumm <- summary(mb)
  
  kable(mbsumm, caption = "Execution time")
  
  ggplot(mbsumm, aes(x = expr, y = mean)) + geom_boxplot() +
    coord_cartesian(ylim = c(0,120)) + ylab("Execution Time") + theme_bw()

```
